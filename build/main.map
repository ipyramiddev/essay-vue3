{"version":3,"sources":["webpack:///webpack/bootstrap 3f8a04a8a782a1c2eaaa","webpack:///external \"jsonwebtoken\"","webpack:///./server/model/md5.js","webpack:///./server/model/db.js","webpack:///external \"path\"","webpack:///./server/index.js","webpack:///external \"nuxt\"","webpack:///external \"body-parser\"","webpack:///external \"cookie-parser\"","webpack:///external \"express\"","webpack:///external \"cors\"","webpack:///./server/model/router.js","webpack:///external \"crypto\"","webpack:///external \"mongodb\"","webpack:///./server/model/settings.js","webpack:///external \"formidable\"","webpack:///external \"fs\"","webpack:///./server/model/has-token.js","webpack:///./nuxt.config.js"],"names":["crypto","require","module","exports","content","md5","createHash","newContent","update","digest","MongoClient","settings","_connectDB","callback","url","dbUrl","connect","err","db","init","user","pass","nickname","avatar","intro","json","usersCollection","collection","find","toArray","result","console","log","close","length","insertOne","res","collectionName","queryJson","query","limit","Number","count","page","sort","cursor","skip","results","deleteMany","updateMany","jsonOld","jsonNew","$set","$currentDate","Nuxt","Builder","bodyParser","cookieParser","express","app","cors","jwt","path","router","hasToken","resolve","__dirname","file","host","process","env","HOST","port","PORT","set","use","static","get","posts","admin","getArticle","tags","tag","search","archives","archive","articles","post","upload","delete","deleteArticle","req","next","username","body","password","code","message","id","_id","serverToken","sign","userID","cookie","maxAge","token","clearCookie","msg","title","date","state","newData","result2","result3","put","clientToken","headers","decoded","verify","oldPass","newPass","noData","config","dev","nuxt","builder","build","render","listen","formidable","fs","sortInfo","total","protocol","lastModified","articleID","key","arr","arr2","i","j","push","reverse","decodeURI","$all","q","$regex","year","Date","getFullYear","month","getMonth","slice","samllMonth","bigMonth","smallDate","getTime","bigDate","$lt","$gte","form","IncomingForm","parse","fields","files","size","unlink","extname","name","oldUrl","newUrl","avatarName","readStream","createReadStream","writeStream","createWriteStream","pipe","on","lastItem","Object","keys","now","imgUrl","send","head","meta","charset","hid","link","rel","type","href","runningPort","vendor","css","src","lang","loading","color","manifest","description","theme_color","modules","plugins"],"mappings":"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","file":"main.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, {\n \t\t\t\tconfigurable: false,\n \t\t\t\tenumerable: true,\n \t\t\t\tget: getter\n \t\t\t});\n \t\t}\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"/\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 4);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 3f8a04a8a782a1c2eaaa","module.exports = require(\"jsonwebtoken\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"jsonwebtoken\"\n// module id = 0\n// module chunks = 0","let crypto = require('crypto')\r\nmodule.exports = function (content) {\r\n    let md5 = crypto.createHash('md5')\r\n    let newContent = md5.update(content).digest('base64')\r\n    return newContent\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/model/md5.js","const MongoClient = require('mongodb').MongoClient\r\nconst settings = require('./settings')\r\n// 链接数据库 如果没有自动创建\r\nfunction _connectDB(callback) {\r\n  let url = settings.dbUrl\r\n  MongoClient.connect(url, function(err, db) {\r\n    if (err) {\r\n      callback(err, null)\r\n      return\r\n    }\r\n    // 数据库链接成功执行回掉\r\n    callback(err, db)\r\n  })\r\n}\r\n\r\n(function init() {\r\n  let user = settings.user,\r\n    pass = settings.pass,\r\n    nickname = settings.nickname || '暂无昵称'\r\n    avatar = settings.avatar || '',\r\n    intro = settings.intro || '暂无介绍'\r\n  let json = { \"user\": user, \"pass\": pass, \"avatar\": avatar, \"intro\": intro, \"nickname\": nickname }\r\n  _connectDB(function(err, db) {\r\n    let usersCollection = db.collection('users')\r\n    usersCollection.find({ \"user\": user }).toArray(function(err, result) {\r\n      if (err) {\r\n        console.log('查询管理员失败')\r\n        db.close\r\n        return\r\n      }\r\n      if (result.length !== 0) {\r\n        db.close()\r\n        return\r\n        // usersCollection.deleteMany({ \"user\": user })\r\n      }\r\n      usersCollection.insertOne(json, function(err, res) {\r\n        if (err) {\r\n          console.log('管理员信息初始化失败')\r\n          db.close()\r\n          return\r\n        }\r\n        console.log('管理员信息初始化成功')\r\n        db.close()\r\n      })\r\n    })\r\n  })\r\n})()\r\n\r\n// 插入数据\r\nexports.insertOne = function(collectionName, json, callback) {\r\n  _connectDB(function(err, db) {\r\n    db.collection(collectionName).insertOne(json, function(err, result) {\r\n      if (err) {\r\n        callback(err, null)\r\n        db.close()\r\n        return\r\n      }\r\n      callback(err, result)\r\n      db.close()\r\n    })\r\n  })\r\n}\r\n\r\n// 查找数据\r\nexports.find = function(collectionName, queryJson, callback) {\r\n  _connectDB(function(err, db) {\r\n    let json = queryJson.query || {},\r\n      limit = Number(queryJson.limit) || 0,\r\n      count = Number(queryJson.page) - 1,\r\n      sort = queryJson.sort || {}\r\n    // 页数为0或者1都显示前limit条数据\r\n    if (count <= 0) {\r\n      count = 0\r\n    } else {\r\n      count = count * limit\r\n    }\r\n\r\n    let cursor = db.collection(collectionName).find(json).limit(limit).skip(count).sort(sort)\r\n    cursor.toArray(function(err, results) {\r\n      if (err) {\r\n        callback(err, null)\r\n        db.close()\r\n        return\r\n      }\r\n      callback(err, results)\r\n      db.close()\r\n    })\r\n  })\r\n}\r\n\r\n// 删除数据\r\nexports.deleteMany = function(collectionName, json, callback) {\r\n  _connectDB(function(err, db) {\r\n    db.collection(collectionName).deleteMany(json, function(err, results) {\r\n      if (err) {\r\n        callback(err, null)\r\n        db.close()\r\n        return\r\n      }\r\n      callback(err, results)\r\n      db.close()\r\n    })\r\n  })\r\n}\r\n\r\n// 修改数据\r\nexports.updateMany = function(collectionName, jsonOld, jsonNew, callback) {\r\n  _connectDB(function(err, db) {\r\n    db.collection(collectionName).updateMany(\r\n      jsonOld, {\r\n        $set: jsonNew,\r\n        $currentDate: { \"lastModified\": false }\r\n      },\r\n      function(err, results) {\r\n        if (err) {\r\n          callback(err, null)\r\n          db.close()\r\n          return\r\n        }\r\n        callback(err, results)\r\n        db.close()\r\n      })\r\n  })\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/model/db.js","module.exports = require(\"path\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"path\"\n// module id = 3\n// module chunks = 0","const { Nuxt, Builder } = require('nuxt')\r\nconst bodyParser = require('body-parser')\r\nconst cookieParser = require('cookie-parser')\r\nconst express = require('express')\r\nconst app = express()\r\nconst cors = require('cors')\r\nconst jwt = require('jsonwebtoken')\r\nconst path = require('path')\r\nconst router = require('./model/router.js')\r\nconst hasToken = require('./model/has-token.js')\r\nconst md5 = require('./model/md5.js')\r\nconst db = require('./model/db.js')\r\nconst resolve = file => path.resolve(__dirname, file)\r\nconst host = process.env.HOST || '127.0.0.1'\r\nconst port = process.env.PORT || 3000\r\n\r\napp.set('port', port)\r\napp.use(bodyParser.json())\r\napp.use(cookieParser())\r\n// 允许跨域\r\napp.use(cors())\r\n// 静态public\r\napp.use('/public', express.static(resolve('../public')))\r\n\r\n// 获取已发布文章列表\r\napp.get('/v1/posts', router.posts)\r\n\r\n// 获取管理员信息\r\napp.get('/v1/administrator', router.admin)\r\n\r\n// 获取文章详情 eg:http://localhost:8080/v1/article?id=1496841740682\r\napp.get('/v1/article', router.getArticle)\r\n\r\n// 获取标签列表\r\napp.get('/v1/tags', router.tags)\r\n\r\n// 获取某个标签下的文章列表  eg: http://localhost:8080/v1/tag?tag=javascript\r\napp.get('/v1/tag', router.tag)\r\n\r\n// 搜索(目前仅支持按标题搜索) eg:http://localhost:8080/v1/search?q=j\r\napp.get('/v1/search', router.search)\r\n\r\n// 获取归档列表\r\napp.get('/v1/archives', router.archives)\r\n\r\n// 获取某个归档下的文章列表 eg:http://localhost:8080/v1/archive?date=201706\r\napp.get('/v1/archive', router.archive)\r\n\r\n// 获取所有文章(包括草稿)\r\napp.get('/v1/articles', hasToken, router.articles)\r\n\r\n// 更新管理员头像\r\napp.post('/v1/avatar', hasToken, router.avatar)\r\n\r\n// 发布文章时，文章中的图片上传接口\r\napp.post('/v1/upload', hasToken, router.upload)\r\n\r\n// 删除文章 eg: http://localhost:8080/v1/article?id=1496841740682\r\napp.delete('/v1/article', hasToken, router.deleteArticle)\r\n\r\n/* \r\n * 以下是有数据提交的请求 \r\n * 目前实现的并不优雅，如果你有好的实现的方式，欢迎交流\r\n*/\r\n\r\n// 登录\r\napp.post('/v1/login', function(req, res, next) {\r\n  let username = req.body.username;\r\n  let password = req.body.password;\r\n  password = md5(password)\r\n\r\n  // 根据用户名查询数据库\r\n  db.find('users', { user: username }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 500,\r\n        message: \"内部服务器错误\"\r\n      })\r\n    }\r\n\r\n    if (result.length === 0) {\r\n      return res.json({\r\n        code: 401,\r\n        message: \"找不到用户名\"\r\n      })\r\n    }\r\n\r\n    // console.log(result)\r\n    let id = result[0]._id\r\n\r\n    if (result[0].user === username && result[0].pass === password) {\r\n      // token包含了用户的名字和唯一id\r\n      const serverToken = jwt.sign({ username: username, userID: id }, 'vueblog');\r\n      // 把token存储到cookie中\r\n      res.cookie('token', serverToken, { maxAge: 60000 * 60 * 24 * 30 })\r\n      return res.json({\r\n        code: 200,\r\n        message: \"登录成功\",\r\n        token: serverToken\r\n      })\r\n    } else {\r\n      return res.json({\r\n        code: 401,\r\n        message: \"密码错误\"\r\n      })\r\n    }\r\n  })\r\n})\r\n\r\n// 登出\r\napp.post('/v1/logout', function(req, res) {\r\n  res.clearCookie('token')\r\n  res.json({\r\n    code: 200,\r\n    msg: '退出登录'\r\n  })\r\n})\r\n\r\n// 发布文章，发布草稿，编辑文章\r\napp.post('/v1/article', hasToken, function(req, res, next) {\r\n  let title = req.body.title;\r\n  let content = req.body.content;\r\n  let tag = req.body.tag;\r\n  let date = req.body.date;\r\n  let state = req.body.state;\r\n  let newData = {\r\n    title: title,\r\n    content: content,\r\n    tag: tag,\r\n    state: state,\r\n    date: date\r\n  };\r\n\r\n  db.find('infos', { \"query\": { \"date\": date } }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 500,\r\n        message: \"内部服务器错误\"\r\n      })\r\n    }\r\n    // 能通过发布日期找到文章，说明你编辑了文章\r\n    if (result.length === 1) {\r\n      db.updateMany('infos', { \"date\": date }, newData, function(err, result2) {\r\n        if (err) {\r\n          console.log(err)\r\n          return res.json({\r\n            code: 401,\r\n            message: \"文章更新失败\"\r\n          })\r\n        }\r\n\r\n        return res.json({\r\n          code: 200,\r\n          message: \"文章更新成功\"\r\n        })\r\n      })\r\n    } else {\r\n      // 插入到数据库\r\n      db.insertOne('infos', newData, function(err, result3) {\r\n        if (err) {\r\n          console.log(err)\r\n          return res.json({\r\n            code: 401,\r\n            message: \"文章发布失败\"\r\n          })\r\n        }\r\n\r\n        if (state === 'draft') {\r\n          return res.json({\r\n            code: 200,\r\n            message: \"草稿保存草稿\"\r\n          })\r\n        }\r\n        return res.json({\r\n          code: 200,\r\n          message: \"文章发布成功\"\r\n        })\r\n      })\r\n    }\r\n  })\r\n})\r\n\r\n// 更新管理员信息\r\napp.put('/v1/administrator', hasToken, function(req, res, next) {\r\n  const clientToken = req.headers.token\r\n  const decoded = jwt.verify(clientToken, 'vueblog');\r\n  const username = decoded.username\r\n  db.updateMany('users', { user: username }, req.body, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 401,\r\n        message: \"信息修改失败\"\r\n      })\r\n    }\r\n\r\n    return res.json({\r\n      code: 200,\r\n      message: \"信息修改成功\"\r\n    })\r\n  })\r\n})\r\n\r\n// 修改密码\r\napp.put('/v1/password', hasToken, function(req, res, next) {\r\n  const clientToken = req.headers.token\r\n  const decoded = jwt.verify(clientToken, 'vueblog');\r\n  const username = decoded.username\r\n\r\n  let oldPass = md5(req.body.oldPass)\r\n  let newPass = md5(req.body.newPass)\r\n  db.find('users', {}, function(err, result) {\r\n    if (oldPass !== result[0].pass) {\r\n      return res.json({\r\n        code: 403,\r\n        message: \"旧密码输入有误\"\r\n      })\r\n    }\r\n\r\n    db.updateMany('users', { \"user\": username }, { \"pass\": newPass }, function(err, result2) {\r\n      if (err) {\r\n        console.log(err)\r\n        return res.json({\r\n          code: 401,\r\n          message: \"密码修改失败\"\r\n        })\r\n      }\r\n      return res.json({\r\n        code: 200,\r\n        message: \"密码修改成功\"\r\n      })\r\n    })\r\n  })\r\n})\r\n\r\n// api地址错误处理\r\napp.get('/v1/*', router.noData)\r\napp.post('/v1/*', router.noData)\r\napp.put('/v1/*', router.noData)\r\napp.delete('/v1/*', router.noData)\r\n\r\n// Import and Set Nuxt.js options\r\nlet config = require('../nuxt.config.js')\r\nconfig.dev = !(process.env.NODE_ENV === 'production')\r\n\r\n// Init Nuxt.js\r\nconst nuxt = new Nuxt(config)\r\n\r\n// Build only in dev mode\r\nif (config.dev) {\r\n  const builder = new Builder(nuxt)\r\n  builder.build()\r\n}\r\n\r\n// Give nuxt middleware to express\r\napp.use(nuxt.render)\r\n\r\n// Listen the server\r\napp.listen(port, host)\r\nconsole.log('Server listening on ' + host + ':' + port) // eslint-disable-line no-console\n\n\n// WEBPACK FOOTER //\n// ./server/index.js","module.exports = require(\"nuxt\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"nuxt\"\n// module id = 5\n// module chunks = 0","module.exports = require(\"body-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"body-parser\"\n// module id = 6\n// module chunks = 0","module.exports = require(\"cookie-parser\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cookie-parser\"\n// module id = 7\n// module chunks = 0","module.exports = require(\"express\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"express\"\n// module id = 8\n// module chunks = 0","module.exports = require(\"cors\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"cors\"\n// module id = 9\n// module chunks = 0","const md5 = require('./md5.js')\r\nconst db = require('./db.js')\r\nconst formidable = require('formidable')\r\nconst fs = require('fs')\r\nconst path = require('path')\r\nconst jwt = require('jsonwebtoken')\r\n\r\nexports.posts = function(req, res, next) {\r\n  let limit = Number(req.query.limit)\r\n  let page = Number(req.query.page)\r\n  let sortInfo = Number(req.query.sort) || -1;\r\n  let sort = { \"date\": sortInfo };\r\n  db.find('infos', { \"query\": { \"state\": \"publish\" }, \"limit\": limit, \"page\": page, \"sort\": sort }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据查询失败\",\r\n        result: []\r\n      })\r\n    }\r\n    db.find('infos', { \"query\": { \"state\": \"publish\" } }, function(err, result2) {\r\n      if (err) {\r\n        console.log(err)\r\n        return res.json({\r\n          code: 404,\r\n          message: \"数据获取失败\",\r\n          result: []\r\n        })\r\n      }\r\n\r\n      result2 = {\r\n        code: 200,\r\n        message: \"数据获取成功\",\r\n        result: result,\r\n        total: result2.length\r\n      }\r\n      return res.json(result2)\r\n    })\r\n  })\r\n}\r\n\r\nexports.admin = function(req, res, next) {\r\n  let path = req.protocol + '://' + req.headers.host + '/public/avatars/'\r\n  db.find('users', {}, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据获取失败\",\r\n        result: {}\r\n      })\r\n    }\r\n\r\n    delete result[0].pass\r\n    delete result[0]._id\r\n    delete result[0].lastModified\r\n    result[0].avatar = path + result[0].avatar\r\n\r\n    return res.json({\r\n      code: 200,\r\n      message: \"数据获取成功\",\r\n      result: result[0]\r\n    })\r\n  })\r\n}\r\n\r\nexports.getArticle = function(req, res, next) {\r\n  let articleID = Number(req.query.id) || false;\r\n  let query = { \"date\": articleID };\r\n  for (let key in query) {\r\n    if (!query[key]) {\r\n      delete query[key]\r\n    }\r\n  }\r\n\r\n  db.find('infos', { \"query\": query }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据获取失败\",\r\n        result: {}\r\n      })\r\n    }\r\n\r\n    return res.json({\r\n      code: 200,\r\n      message: \"数据获取成功\",\r\n      result: result[0]\r\n    })\r\n  })\r\n}\r\n\r\nexports.tags = function(req, res, next) {\r\n  db.find('infos', { \"query\": { \"state\": \"publish\" } }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据获取失败\",\r\n        result: []\r\n      })\r\n    }\r\n\r\n    let arr = [],\r\n      arr2 = [];\r\n    for (let i = 0; i < result.length; i++) {\r\n      for (let j = 0; j < result[i].tag.length; j++) {\r\n        arr.push(result[i].tag[j])\r\n      }\r\n    }\r\n\r\n    arr.sort()\r\n    for (let i = 0; i < arr.length;) {\r\n      let count = 0;\r\n      for (let j = i; j < arr.length; j++) {\r\n        if (arr[i] === arr[j]) {\r\n          count++;\r\n        }\r\n      }\r\n      arr2.push({\r\n        tag: arr[i],\r\n        count: count\r\n      })\r\n      i += count;\r\n    }\r\n\r\n    arr2.reverse()\r\n    return res.json({\r\n      code: 200,\r\n      message: \"数据获取成功\",\r\n      result: arr2\r\n    })\r\n  })\r\n}\r\n\r\nexports.tag = function(req, res, next) {\r\n  let tag = [];\r\n  if (req.query.tag) {\r\n    tag.push(decodeURI(req.query.tag))\r\n  }\r\n  let limit = Number(req.query.limit)\r\n  let page = Number(req.query.page)\r\n  let sortInfo = Number(req.query.sort) || -1;\r\n  let sort = { \"date\": sortInfo };\r\n  db.find('infos', { \"query\": { \"state\": \"publish\", \"tag\": { $all: tag } }, \"limit\": limit, \"page\": page, \"sort\": sort }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据查询失败\",\r\n        result: []\r\n      })\r\n    }\r\n\r\n    db.find('infos', { \"query\": { \"state\": \"publish\", \"tag\": { $all: tag } } }, function(err, result2) {\r\n      if (err) {\r\n        console.log(err)\r\n        return res.json({\r\n          code: 404,\r\n          message: \"数据获取失败\",\r\n          result: []\r\n        })\r\n      }\r\n\r\n      result2 = {\r\n        code: 200,\r\n        message: \"数据获取成功\",\r\n        result: result,\r\n        total: result2.length\r\n      }\r\n      return res.json(result2)\r\n    })\r\n  })\r\n}\r\n\r\nexports.search = function(req, res, next) {\r\n  let q = req.query.q ? decodeURI(req.query.q) : ''\r\n  let limit = Number(req.query.limit)\r\n  let page = Number(req.query.page)\r\n  let sortInfo = Number(req.query.sort) || -1;\r\n  let sort = { \"date\": sortInfo };\r\n  db.find('infos', { \"query\": { \"state\": \"publish\", \"title\": { $regex: \".*\" + q + \".*\" } }, \"limit\": limit, \"page\": page, \"sort\": sort }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据查询失败\",\r\n        result: []\r\n      })\r\n    }\r\n\r\n    db.find('infos', { \"query\": { \"state\": \"publish\", \"title\": { $regex: \".*\" + q + \".*\" } } }, function(err, result2) {\r\n      if (err) {\r\n        console.log(err)\r\n        return res.json({\r\n          code: 404,\r\n          message: \"数据获取失败\",\r\n          result: []\r\n        })\r\n      }\r\n\r\n      result2 = {\r\n        code: 200,\r\n        message: \"数据获取成功\",\r\n        result: result,\r\n        total: result2.length\r\n      }\r\n      res.json(result2)\r\n    })\r\n  })\r\n}\r\n\r\nexports.archives = function(req, res, next) {\r\n  db.find('infos', { \"query\": { \"state\": \"publish\" } }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据获取失败\",\r\n        result: []\r\n      })\r\n    }\r\n\r\n    let arr = [],\r\n      arr2 = [];\r\n\r\n    for (let i = 0; i < result.length; i++) {\r\n      let year = new Date(result[i].date).getFullYear() + ''\r\n      let month = new Date(result[i].date).getMonth() + 1 + ''\r\n      if (month.length === 1) {\r\n        month = '0' + month;\r\n      }\r\n      // let date = `${year}年${month}月`;\r\n      let date = `${year}${month}`;\r\n      arr.push(date)\r\n    }\r\n\r\n    arr.sort()\r\n    for (let i = 0; i < arr.length;) {\r\n      let count = 0;\r\n      for (let j = i; j < arr.length; j++) {\r\n        if (arr[i] === arr[j]) {\r\n          count++;\r\n        }\r\n      }\r\n      arr2.push({\r\n        date: arr[i],\r\n        count: count\r\n      })\r\n      i += count;\r\n    }\r\n\r\n    arr2.reverse()\r\n    return res.json({\r\n      code: 200,\r\n      message: \"数据获取成功\",\r\n      result: arr2\r\n    })\r\n  })\r\n}\r\n\r\nexports.archive = function(req, res, next) {\r\n  let limit = Number(req.query.limit)\r\n  let page = Number(req.query.page)\r\n  let sortInfo = Number(req.query.sort) || -1;\r\n  let sort = { \"date\": sortInfo };\r\n\r\n  let year = req.query.date.slice(0, 4)\r\n  let samllMonth = req.query.date.slice(4) - 1;\r\n  let bigMonth = req.query.date.slice(4)\r\n  let smallDate = new Date(+year, +samllMonth).getTime()\r\n  let bigDate = new Date(+year, +bigMonth).getTime()\r\n  db.find('infos', { \"query\": { \"state\": \"publish\", \"date\": { $lt: bigDate, $gte: smallDate } }, \"limit\": limit, \"page\": page, \"sort\": sort }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据获取失败\",\r\n        result: []\r\n      })\r\n    }\r\n    db.find('infos', { \"query\": { \"state\": \"publish\", \"date\": { $lt: bigDate, $gte: smallDate } } }, function(err, result2) {\r\n      result2 = {\r\n        code: 200,\r\n        message: \"数据获取成功\",\r\n        result: result,\r\n        total: result2.length\r\n      }\r\n      return res.json(result2)\r\n    })\r\n  })\r\n}\r\n\r\nexports.articles = function(req, res, next) {\r\n  let limit = Number(req.query.limit)\r\n  let page = Number(req.query.page)\r\n  let sortInfo = Number(req.query.sort) || -1;\r\n  let sort = { \"date\": sortInfo };\r\n  db.find('infos', { \"query\": {}, \"limit\": limit, \"page\": page, \"sort\": sort }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 404,\r\n        message: \"数据查询失败\",\r\n        result: []\r\n      })\r\n    }\r\n\r\n    db.find('infos', { \"query\": {} }, function(err, result2) {\r\n      if (err) {\r\n        console.log(err)\r\n        return res.json({\r\n          code: 404,\r\n          message: \"数据获取失败\",\r\n          result: []\r\n        })\r\n      }\r\n\r\n      result2 = {\r\n        code: 200,\r\n        message: \"数据获取成功\",\r\n        result: result,\r\n        total: result2.length\r\n      }\r\n      return res.json(result2)\r\n    })\r\n  })\r\n}\r\n\r\nexports.avatar = function(req, res, next) {\r\n  const clientToken = req.headers.token\r\n  const decoded = jwt.verify(clientToken, 'vueblog');\r\n  const username = decoded.username\r\n\r\n  let form = new formidable.IncomingForm()\r\n  form.parse(req, function(err, fields, files) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 500,\r\n        message: \"内部服务器错误\"\r\n      })\r\n    }\r\n\r\n    // 限制头像大小 单位默认字节 这里限制大小为1m\r\n    if (files.avatar.size / 1024 > 1024) {\r\n      fs.unlink(files.avatar.path)\r\n      return res.json({\r\n        code: 401,\r\n        message: \"图片应小于1M\"\r\n      })\r\n    }\r\n    // 获取后缀名\r\n    let extname = path.extname(files.avatar.name)\r\n    let oldUrl = files.avatar.path;\r\n    let newUrl = './public/avatars/avatar' + extname;\r\n    let avatarName = 'avatar' + extname;\r\n\r\n    // 头像上传到服务器\r\n    let readStream = fs.createReadStream(oldUrl)\r\n    let writeStream = fs.createWriteStream(newUrl)\r\n    readStream.pipe(writeStream)\r\n    readStream.on('end', function() {\r\n      // 更新数据库中头像的链接信息\r\n      db.updateMany('users', { \"user\": username }, { \"avatar\": avatarName },\r\n        function(err, result) {\r\n          if (err) {\r\n            console.log(err)\r\n            return res.json({\r\n              code: 401,\r\n              message: \"头像更新失败\"\r\n            })\r\n          }\r\n          return res.json({\r\n            code: 200,\r\n            message: \"头像上传成功\"\r\n          })\r\n        })\r\n    })\r\n  })\r\n}\r\n\r\nexports.upload = function(req, res, next) {\r\n  const clientToken = req.headers.token\r\n  const decoded = jwt.verify(clientToken, 'vueblog');\r\n  const username = decoded.username\r\n\r\n  let form = new formidable.IncomingForm()\r\n  form.parse(req, function(err, fields, files) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 401,\r\n        message: \"表单解析错误\"\r\n      })\r\n    }\r\n    // console.log(files)\r\n    // 获取对象的最后一项\r\n    let lastItem = files[Object.keys(files)[Object.keys(files).length - 1]]\r\n\r\n    // 获取后缀名\r\n    let extname = Date.now() + path.extname(lastItem.name)\r\n    let oldUrl = lastItem.path\r\n    let newUrl = './public/pictures/' + extname\r\n    let imgUrl = req.protocol + '://' + req.headers.host + '/public/pictures/' + extname\r\n\r\n    // 更改名字和路径,实现上传\r\n    let readStream = fs.createReadStream(oldUrl)\r\n    let writeStream = fs.createWriteStream(newUrl)\r\n    readStream.pipe(writeStream)\r\n    readStream.on('end', function() {\r\n      return res.send(imgUrl)\r\n    })\r\n  })\r\n}\r\n\r\nexports.deleteArticle = function(req, res, next) {\r\n  let id = Number(req.query.id) || ''\r\n  db.deleteMany('infos', { date: id }, function(err, result) {\r\n    if (err) {\r\n      console.log(err)\r\n      return res.json({\r\n        code: 401,\r\n        message: \"文章删除失败\"\r\n      })\r\n    }\r\n\r\n    return res.json({\r\n      code: 200,\r\n      message: \"文章删除成功\"\r\n    })\r\n  })\r\n}\r\n\r\nexports.noData = function(req, res, next) {\r\n  return res.json({\r\n    code: 404,\r\n    message: '数据获取失败'\r\n  })\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/model/router.js","module.exports = require(\"crypto\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"crypto\"\n// module id = 11\n// module chunks = 0","module.exports = require(\"mongodb\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"mongodb\"\n// module id = 12\n// module chunks = 0","/**\r\n * Created by dell on 2017/5/14.\r\n */\r\nlet md5 = require('./md5.js')\r\nlet user = 'q'\r\nlet pass = md5('q')\r\nlet avatar = 'avatar.jpg'\r\nlet intro ='Never too old to learn'\r\nlet nickname = 'VueBlog'\r\nmodule.exports = {\r\n    dbUrl:'mongodb://localhost:27017/vueblog',\r\n    user:user,\r\n    pass:pass,\r\n    avatar:avatar,\r\n    intro:intro,\r\n    nickname:nickname\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/model/settings.js","module.exports = require(\"formidable\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"formidable\"\n// module id = 14\n// module chunks = 0","module.exports = require(\"fs\");\n\n\n//////////////////\n// WEBPACK FOOTER\n// external \"fs\"\n// module id = 15\n// module chunks = 0","const jwt = require('jsonwebtoken')\r\nconst db = require('./db.js')\r\nmodule.exports = (req, res, next) => {\r\n  const clientToken = req.headers.token\r\n  if (clientToken) {\r\n    const decoded = jwt.verify(clientToken, 'vueblog');\r\n    // 从token中拿到用户名和userID\r\n    const username = decoded.username\r\n    const userID = decoded.userID\r\n    // 查找数据库对比用户信息\r\n    db.find('users', {}, function(err, result) {\r\n      if (result[0].user === username && result[0]._id + '' === userID) {\r\n        next()\r\n      } else {\r\n        return res.json({\r\n          code: 401,\r\n          message: \"验证失败\"\r\n        })\r\n      }\r\n    })\r\n  } else {\r\n    return res.json({\r\n      \"code\": 401,\r\n      \"message\": \"请登录后操作\"\r\n    })\r\n  }\r\n}\n\n\n// WEBPACK FOOTER //\n// ./server/model/has-token.js","module.exports = {\r\n  head: {\r\n    title: 'vueblog',\r\n    meta: [\r\n      { charset: 'utf-8' },\r\n      { name: 'viewport', content: 'width=device-width, initial-scale=1' },\r\n      { hid: 'description', name: 'description', content: '支持(vue ssr)服务端渲染的前后端分离博客系统，基于Nuxt.js和Vue.js开发，采用Node.js作中间渲染层，支持PWA，markdown编辑器极速书写，vueblog只为追求良好的用户体验' }\r\n    ],\r\n    link: [\r\n      { rel: 'icon', type: 'image/x-icon', href: '/favicon.ico' }\r\n    ]\r\n  },\r\n  env: {\r\n    runningPort: process.env.PORT || 3000\r\n  },\r\n  build: { vendor: ['axios', 'highlight.js'] },\r\n  css: ['normalize.css/normalize.css', 'highlight.js/styles/github.css', {src: '~assets/css/main.scss', lang: 'scss'}],\r\n  loading: { color: '#337AB7' },\r\n  manifest: {\r\n    name: 'VueBlog',\r\n    description: 'A blog system',\r\n    theme_color: '#188269'\r\n  },\r\n  modules: [\r\n    '@nuxtjs/pwa',\r\n    '@nuxtjs/component-cache'\r\n  ],\r\n  plugins: [\r\n    '~plugins/filters.js'\r\n  ]\r\n}\r\n\n\n\n// WEBPACK FOOTER //\n// ./nuxt.config.js"],"sourceRoot":""}